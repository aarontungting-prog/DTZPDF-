<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <title>DTZ PDF - å°ˆæ¥­ç´šæ–‡ä»¶è™•ç†åŸºçŸ³</title>
   
  <script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

  <style>
    :root {
      --primary: #e74c3c; --accent: #3498db; --success: #2ecc71; --bg: #f8fafc;
      --text-main: #2d3436; --text-sub: #636e72; --border: #dfe6e9;
      --shadow: 0 10px 30px rgba(0,0,0,0.08); --radius: 16px;
    }
    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    body { font-family: 'Segoe UI', system-ui, sans-serif; margin: 0; background: var(--bg); color: var(--text-main); line-height: 1.6; }

    /* --- å°èˆª --- */
    nav { background: white; padding: 1rem 5%; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 15px rgba(0,0,0,0.04); position: sticky; top: 0; z-index: 100; }
    .logo { font-size: 1.5rem; font-weight: 800; color: var(--primary); letter-spacing: -0.5px; }
    .badge { background: #f1f2f6; color: var(--text-sub); font-size: 0.75rem; padding: 4px 12px; border-radius: 50px; font-weight: 600; }

    .container { max-width: 1000px; margin: 40px auto; padding: 0 20px; }
    .header { text-align: center; margin-bottom: 40px; }
    .header h1 { margin: 0 0 10px 0; font-size: 2.2rem; }
    .header p { color: var(--text-sub); margin: 0; }

    /* --- æ¨™ç±¤èˆ‡é¢æ¿ --- */
    .tab-group { display: flex; justify-content: center; gap: 10px; margin-bottom: 30px; }
    .tab-btn { padding: 12px 35px; border-radius: 50px; border: 2px solid transparent; background: white; color: var(--text-sub); font-weight: 700; cursor: pointer; transition: 0.2s; box-shadow: 0 4px 10px rgba(0,0,0,0.03); }
    .tab-btn.active { border-color: var(--primary); color: var(--primary); box-shadow: 0 8px 20px rgba(231, 76, 60, 0.2); transform: translateY(-2px); }

    .panel { display: none; background: white; padding: 40px; border-radius: var(--radius); box-shadow: var(--shadow); min-height: 500px; animation: fadeUp 0.4s ease; }
    .panel.active { display: block; }

    .drop-zone { border: 3px dashed var(--border); border-radius: var(--radius); padding: 60px 20px; text-align: center; cursor: pointer; transition: 0.3s; position: relative; overflow: hidden; }
    .drop-zone:hover, .drop-zone.dragover { border-color: var(--primary); background: #fff5f5; }
    .drop-zone input { position: absolute; width: 0; height: 0; opacity: 0; }

    /* --- å¡ç‰‡ç¶²æ ¼ --- */
    .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 20px; margin-top: 30px; }
    .card { background: white; border: 1px solid var(--border); padding: 10px; border-radius: 12px; position: relative; transition: 0.2s; cursor: grab; }
    .card:active { cursor: grabbing; }
    .card.selected { border: 2px solid var(--success); background: #f0fff4; }
     
    .preview-box { height: 200px; display: flex; align-items: center; justify-content: center; background: #f8f9fa; border-radius: 8px; overflow: hidden; margin-bottom: 10px; }
    canvas { max-width: 100%; max-height: 100%; transition: transform 0.3s; }
     
    .tools { display: flex; gap: 5px; justify-content: center; }
    .tool-btn { flex: 1; padding: 6px; border: none; background: #f1f2f6; color: var(--text-sub); border-radius: 6px; cursor: pointer; font-size: 0.8rem; font-weight: 600; transition: 0.2s; }
    .tool-btn:hover { background: #dfe6e9; color: var(--text-main); }
    .tool-btn.danger:hover { background: #ffebee; color: var(--primary); }

    .actions { margin-top: 40px; padding-top: 20px; border-top: 1px solid var(--border); display: none; text-align: center; }
    .btn-main { padding: 16px 60px; border-radius: 50px; border: none; background: var(--primary); color: white; font-size: 1.1rem; font-weight: 700; cursor: pointer; transition: 0.3s; box-shadow: 0 5px 15px rgba(231, 76, 60, 0.3); }
    .btn-main:hover { transform: translateY(-2px); box-shadow: 0 10px 25px rgba(231, 76, 60, 0.4); }
    .btn-main:disabled { background: #b2bec3; cursor: wait; transform: none; box-shadow: none; }
    .btn-text { background: none; border: none; color: var(--text-sub); text-decoration: underline; cursor: pointer; margin-top: 15px; display: block; width: 100%; }

    /* --- âœ… æ–°å¢ï¼šäº’å‹•å¼è³‡è¨Šå¡ç‰‡ (é©ç”¨æ–¼ä¸‰æ–¹æ¡†èˆ‡ Q&A) --- */
    .info-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 25px; margin-top: 60px; }
     
    .anim-card {
      background: white; padding: 30px; border-radius: 20px; 
      box-shadow: var(--shadow); text-align: left; 
      transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
      border-top: 6px solid transparent; cursor: default;
    }
    /* æ‡¸åœå‹•ç•« */
    .anim-card:hover { transform: translateY(-8px); box-shadow: 0 20px 40px rgba(0,0,0,0.12); }
     
    /* é¡è‰²ä¸»é¡Œ */
    .anim-card.feature { border-top-color: var(--primary); }
    .anim-card.qa { border-top-color: var(--accent); }

    .anim-card h3 { margin-top: 0; color: var(--text-main); font-size: 1.2rem; }
    .anim-card h4 { margin-top: 0; color: var(--accent); font-size: 1.1rem; }
    .anim-card p { color: var(--text-sub); font-size: 0.95rem; margin-bottom: 0; }

    /* Q&A å€å¡Šæ¨™é¡Œ */
    .section-title { text-align: center; margin-top: 80px; font-size: 1.8rem; color: var(--text-main); font-weight: 800; }

    /* --- å…¶ä»–å…ƒä»¶ --- */
    #progress-wrap { position: fixed; top: 0; left: 0; width: 100%; height: 4px; z-index: 999; display: none; }
    #progress-bar { width: 0%; height: 100%; background: linear-gradient(90deg, var(--primary), var(--accent)); transition: width 0.2s; }
    #toast-container { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); z-index: 1000; display: flex; flex-direction: column; gap: 10px; }
    .toast { background: rgba(0,0,0,0.8); color: white; padding: 10px 20px; border-radius: 50px; font-size: 0.9rem; animation: fadeUp 0.3s; }
    .rot-90 { transform: rotate(90deg); } .rot-180 { transform: rotate(180deg); } .rot-270 { transform: rotate(270deg); }
    @keyframes fadeUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    @media (max-width: 768px) { .panel { padding: 20px; } .btn-main { width: 100%; } }
    footer { margin: 80px 0 40px; color: #b2bec3; font-size: 0.9rem; text-align: center; }
  </style>
</head>
<body>

<div id="progress-wrap"><div id="progress-bar"></div></div>
<div id="toast-container"></div>

<nav>
  <div class="logo">DTZ PDF</div>
  <div class="badge">v28.1</div>
</nav>

<div class="container">
  <div class="header">
    <h1>å°ˆæ¥­ PDF è™•ç†ä¸­æ¨</h1>
    <p>æœ¬åœ°é‹ç®— â€¢ æ¥µè‡´éš±ç§ â€¢ å¹¾ä½•æ ¡æ­£</p>
  </div>

  <div class="tab-group">
    <button class="tab-btn active" onclick="App.ui.switchTab('merge')">åˆä½µæ’åº</button>
    <button class="tab-btn" onclick="App.ui.switchTab('split')">åˆ†å‰²æå–</button>
  </div>

  <div id="panel-merge" class="panel active">
    <div class="drop-zone" id="drop-merge">
      <div style="font-size:3rem; margin-bottom:15px;">ğŸ“‚</div>
      <h3>æ‹–æ”¾æª”æ¡ˆ æˆ– é»æ“Šä¸Šå‚³</h3>
      <p style="color:var(--text-sub); font-size:0.9rem;">æ”¯æ´ PDF / JPG / PNG (è‡ªå‹•æ’åºèˆ‡æ—‹è½‰)</p>
      <input type="file" id="input-merge" multiple accept=".pdf,.jpg,.jpeg,.png">
    </div>
    <div id="grid-merge" class="grid"></div>
    <div id="action-merge" class="actions">
      <button class="btn-main" onclick="App.core.process('merge')">åˆä½µä¸¦ä¸‹è¼‰ PDF</button>
      <button class="btn-text" onclick="App.state.reset()">æ¸…ç©ºæ‰€æœ‰æª”æ¡ˆ</button>
    </div>
  </div>

  <div id="panel-split" class="panel">
    <div class="drop-zone" id="drop-split">
      <div style="font-size:3rem; margin-bottom:15px;">âœ‚ï¸</div>
      <h3>æ‹–æ”¾å–®ä»½ PDF æª”æ¡ˆ</h3>
      <p style="color:var(--text-sub); font-size:0.9rem;">è§£æå¾Œé»é¸é é¢é€²è¡Œæå–</p>
      <input type="file" id="input-split" accept=".pdf">
    </div>
    <div id="grid-split" class="grid"></div>
    <div id="action-split" class="actions">
      <button class="btn-main" style="background:var(--accent);" onclick="App.core.process('split')">æå–é¸ä¸­é é¢ (ZIP)</button>
    </div>
  </div>

  <div class="info-grid">
    <div class="anim-card feature">
      <h3>ğŸ›¡ï¸ ç«¯é»åŠ å¯†é‹ç®—</h3>
      <p>æ”¾æ£„é›²ç«¯ä¸Šå‚³ï¼Œæ“æŠ±çµ•å°éš±ç§ã€‚æ‰€æœ‰æª”æ¡ˆè™•ç†çš†åœ¨æ‚¨çš„ç€è¦½å™¨è¨˜æ†¶é«”ä¸­å®Œæˆï¼Œé©åˆè™•ç†åˆç´„èˆ‡å€‹è³‡æ–‡ä»¶ã€‚</p>
    </div>
    <div class="anim-card feature">
      <h3>ğŸš€ å¹¾ä½•ç‰©ç†å¼•æ“</h3>
      <p>å…§å»ºåæ¨™è½‰æ›ç³»çµ±ã€‚ç•¶æ‚¨æ—‹è½‰åœ–ç‰‡æ™‚ï¼ŒPDF é é¢æœƒè‡ªå‹•é©æ‡‰å¯¬é«˜ï¼Œç¢ºä¿å…§å®¹å®Œç¾ç½®ä¸­ä¸è£åˆ‡ã€‚</p>
    </div>
    <div class="anim-card feature">
      <h3>âš¡ åˆ†æ®µå‘¼å¸æ¸²æŸ“</h3>
      <p>é‡å°å¤§æª”æ¡ˆå„ªåŒ–çš„éåŒæ­¥è™•ç†æŠ€è¡“ï¼Œå³ä½¿è¼‰å…¥æ•¸ç™¾é çš„åˆç´„ï¼Œä¹Ÿèƒ½ä¿æŒä»‹é¢æµæš¢ä¸å¡é “ã€‚</p>
    </div>
  </div>

  <h2 class="section-title">å¸¸è¦‹å•é¡ŒæŒ‡å—</h2>
  <div class="info-grid">
    <div class="anim-card qa">
      <h4>ğŸ“± iOS ç„¡æ³•ä¸‹è¼‰ï¼Ÿ</h4>
      <p>iPhone Safari å®‰å…¨æ€§è¼ƒé«˜ã€‚åˆä½µå®Œæˆå¾Œè‹¥è·³å‡ºæ–°åˆ†é ï¼Œè«‹é»æ“Šåº•éƒ¨çš„ã€Œåˆ†äº«ã€åœ–ç¤ºï¼Œä¸¦é¸æ“‡ã€Œå„²å­˜åˆ°æª”æ¡ˆã€å³å¯ã€‚</p>
    </div>
    <div class="anim-card qa">
      <h4>âœ‚ï¸ åˆ†å‰²æ¨¡å¼æ€éº¼ç”¨ï¼Ÿ</h4>
      <p>ä¸Šå‚³ PDF å¾Œï¼Œç›´æ¥é»æ“Šæ‚¨æƒ³è¦ä¿ç•™çš„é é¢å¡ç‰‡ã€‚ç•¶å¡ç‰‡å‡ºç¾ç¶ è‰²é‚Šæ¡†æ™‚ä»£è¡¨å·²é¸ä¸­ï¼Œæœ€å¾Œé»æ“Šæå–å³å¯æ‰“åŒ…ä¸‹è¼‰ã€‚</p>
    </div>
    <div class="anim-card qa">
      <h4>ğŸ–¼ï¸ åœ–ç‰‡æœƒè¢«å£“ç¸®å—ï¼Ÿ</h4>
      <p>æˆ‘å€‘æœƒè‡ªå‹•å„ªåŒ–åœ–ç‰‡å°ºå¯¸ä»¥é˜²æ­¢è¨˜æ†¶é«”æº¢å‡ºï¼Œä½†ä»æœƒä¿æŒ 300DPI çš„åˆ—å°ç´šæ¸…æ™°åº¦ï¼Œè«‹æ”¾å¿ƒä½¿ç”¨ã€‚</p>
    </div>
  </div>
</div>

<footer>&copy; 2026 DTZ PDF ENGINE | v28.1 å®Œæ•´äº’å‹•ç‰ˆ</footer>

<script>
/**
 * DTZ PDF Engine v28.1 - ç©©å®šåŸºçŸ³æ¶æ§‹
 */
const App = {
  state: {
    mode: 'merge',
    pages: [],
    buffers: {},
    sortable: null,
    reset() {
      this.pages = [];
      this.buffers = {};
      document.getElementById('grid-merge').innerHTML = '';
      document.getElementById('grid-split').innerHTML = '';
      document.getElementById('action-merge').style.display = 'none';
      document.getElementById('action-split').style.display = 'none';
      App.ui.toast("å·²æ¸…ç©ºæ‰€æœ‰è³‡æ–™");
    }
  },
  ui: {
    switchTab(mode) {
      App.state.mode = mode;
      App.state.reset();
      document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
      document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
      const targetBtn = event ? event.target : document.querySelector(`button[onclick*="'${mode}'"]`);
      if(targetBtn) targetBtn.classList.add('active');
      document.getElementById(`panel-${mode}`).classList.add('active');
    },
    showProgress(percent) {
      const bar = document.getElementById('progress-bar');
      const wrap = document.getElementById('progress-wrap');
      wrap.style.display = 'block';
      bar.style.width = percent + '%';
      if (percent >= 100) setTimeout(() => { wrap.style.display = 'none'; bar.style.width = '0%'; }, 800);
    },
    toast(msg) {
      const con = document.getElementById('toast-container');
      const el = document.createElement('div');
      el.className = 'toast'; el.innerText = msg; con.appendChild(el);
      setTimeout(() => el.remove(), 3000);
    },
    createCard(pageObj, canvas, label) {
      const div = document.createElement('div');
      div.className = 'card'; div.id = pageObj.id;
      const tools = `
        <div class="tools" style="margin-top:10px;">
          <button class="tool-btn" onclick="event.stopPropagation(); App.core.rotate('${pageObj.id}')">â†º æ—‹è½‰</button>
          ${App.state.mode === 'merge' ? `<button class="tool-btn danger" onclick="event.stopPropagation(); App.core.remove('${pageObj.id}')">âœ• åˆªé™¤</button>` : ''}
        </div>`;
      div.innerHTML = `<div class="preview-box"></div><div style="font-size:0.8rem; text-align:center; color:#636e72; margin-top:5px;">${label}</div>${tools}`;
      div.querySelector('.preview-box').appendChild(canvas);
      if (App.state.mode === 'split') {
        div.onclick = () => {
          const p = App.state.pages.find(x => x.id === pageObj.id);
          if (p) { p.selected = !p.selected; div.classList.toggle('selected'); }
        };
      }
      document.getElementById(`grid-${App.state.mode}`).appendChild(div);
    }
  },
  core: {
    async init() {
      const { pdfjsLib } = window;
      pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.worker.min.js';
      ['merge', 'split'].forEach(m => {
        const drop = document.getElementById(`drop-${m}`);
        const input = document.getElementById(`input-${m}`);
        drop.onclick = () => input.click();
        input.onchange = (e) => this.handleFiles(e.target.files);
        drop.addEventListener('dragover', e => { e.preventDefault(); drop.classList.add('dragover'); });
        drop.addEventListener('dragleave', () => drop.classList.remove('dragover'));
        drop.addEventListener('drop', e => { e.preventDefault(); drop.classList.remove('dragover'); this.handleFiles(e.dataTransfer.files); });
      });
    },
    async handleFiles(files) {
      if (files.length === 0) return;
      App.ui.showProgress(10);
      try {
        for (const file of Array.from(files)) {
          if (App.state.mode === 'split' && !file.type.includes('pdf')) { App.ui.toast("âš ï¸ åˆ†å‰²æ¨¡å¼åƒ…æ”¯æ´ PDF æª”æ¡ˆ"); continue; }
          const fileId = crypto.randomUUID();
          const buffer = await file.arrayBuffer();
          App.state.buffers[fileId] = buffer;
          if (file.type === 'application/pdf') {
            const pdfDoc = await pdfjsLib.getDocument({ data: buffer.slice(0) }).promise;
            for (let i = 1; i <= pdfDoc.numPages; i++) {
              const pId = crypto.randomUUID();
              App.state.pages.push({ id: pId, fileId, pIdx: i-1, rot: 0, selected: false, type: 'pdf', name: file.name });
              await this.renderPage(pdfDoc, i, pId);
              if (i % 5 === 0) await new Promise(r => setTimeout(r, 0));
            }
          } else if (file.type.startsWith('image/') && App.state.mode === 'merge') {
            const pId = crypto.randomUUID();
            App.state.pages.push({ id: pId, fileId, pIdx: 0, rot: 0, selected: false, type: 'img', name: file.name });
            await this.renderImage(file, pId);
          }
        }
        document.getElementById(`action-${App.state.mode}`).style.display = 'block';
        if (App.state.mode === 'merge') this.initSortable();
      } catch (e) { console.error(e); App.ui.toast("âŒ æª”æ¡ˆè§£æå¤±æ•—"); }
      App.ui.showProgress(100);
    },
    async renderPage(pdfDoc, num, id) {
      const page = await pdfDoc.getPage(num);
      const vp = page.getViewport({ scale: 0.3 });
      const cv = document.createElement('canvas');
      cv.width = vp.width; cv.height = vp.height;
      await page.render({ canvasContext: cv.getContext('2d'), viewport: vp }).promise;
      App.ui.createCard(App.state.pages.find(p => p.id === id), cv, `P${num}`);
    },
    async renderImage(file, id) {
      const img = new Image(); img.src = URL.createObjectURL(file);
      await new Promise(r => img.onload = r);
      const maxW = 300; const sc = maxW / img.width;
      const cv = document.createElement('canvas');
      cv.width = maxW; cv.height = img.height * sc;
      cv.getContext('2d').drawImage(img, 0, 0, cv.width, cv.height);
      App.ui.createCard(App.state.pages.find(p => p.id === id), cv, 'IMG');
      URL.revokeObjectURL(img.src);
    },
    rotate(id) {
      const p = App.state.pages.find(x => x.id === id);
      if (p) { p.rot = (p.rot + 90) % 360; const cv = document.querySelector(`#${id} canvas`); if(cv) cv.className = `rot-${p.rot}`; }
    },
    remove(id) {
      App.state.pages = App.state.pages.filter(x => x.id !== id);
      document.getElementById(id).remove();
      if (App.state.pages.length === 0) App.state.reset();
    },
    initSortable() {
      const el = document.getElementById('grid-merge');
      if (App.state.sortable) App.state.sortable.destroy();
      App.state.sortable = new Sortable(el, {
        animation: 150,
        ghostClass: 'sortable-ghost',
        onEnd: () => {
          const ids = Array.from(el.children).map(c => c.id);
          App.state.pages = ids.map(id => App.state.pages.find(p => p.id === id)).filter(Boolean);
        }
      });
    },
    async process(mode) {
      const targets = mode === 'split' ? App.state.pages.filter(p => p.selected) : App.state.pages;
      if (targets.length === 0) return App.ui.toast(mode === 'split' ? "è«‹å…ˆé»é¸é é¢ (ç¶ æ¡†)" : "ç„¡æª”æ¡ˆå¯è™•ç†");
      App.ui.showProgress(20);
      const { PDFDocument, degrees } = PDFLib;
      try {
        if (mode === 'merge') {
          const doc = await PDFDocument.create();
          for (const p of targets) { await this.addToDoc(doc, p); }
          this.download(await doc.save(), `Merged_${Date.now()}.pdf`, 'application/pdf');
        } else {
          const zip = new JSZip();
          let count = 0;
          for (const p of targets) {
            const doc = await PDFDocument.create();
            await this.addToDoc(doc, p);
            const safeName = (p.name || "doc").replace(/\.pdf$/i, "");
            zip.file(`${safeName}_Page${++count}.pdf`, await doc.save());
          }
          this.download(await zip.generateAsync({type:'blob'}), `Split_${Date.now()}.zip`, 'application/zip');
        }
        App.ui.toast("âœ… è™•ç†å®Œæˆï¼");
      } catch (e) { console.error(e); App.ui.toast("âŒ è™•ç†å¤±æ•—ï¼Œè«‹æª¢æŸ¥æª”æ¡ˆ"); }
      App.ui.showProgress(100);
    },
    async addToDoc(targetDoc, p) {
      const { PDFDocument, degrees } = PDFLib;
      const buffer = App.state.buffers[p.fileId];
      if (p.type === 'pdf') {
        const src = await PDFDocument.load(buffer);
        const [page] = await targetDoc.copyPages(src, [p.pIdx]);
        page.setRotation(degrees(p.rot + (page.getRotation().angle || 0)));
        targetDoc.addPage(page);
      } else {
        const img = p.name.toLowerCase().endsWith('png') ? await targetDoc.embedPng(buffer) : await targetDoc.embedJpg(buffer);
        const isRotated = p.rot === 90 || p.rot === 270;
        const dims = isRotated ? { w: img.height, h: img.width } : { w: img.width, h: img.height };
        const page = targetDoc.addPage([dims.w, dims.h]);
        let x = 0, y = 0;
        if (p.rot === 90) x = img.height;
        else if (p.rot === 180) { x = img.width; y = img.height; }
        else if (p.rot === 270) y = img.width;
        page.drawImage(img, { x, y, width: img.width, height: img.height, rotate: degrees(p.rot) });
      }
    },
    download(data, name, type) {
      const blob = new Blob([data], { type });
      const url = URL.createObjectURL(blob);
      if (/iPhone|iPad|iPod/i.test(navigator.userAgent)) {
        window.open(url, '_blank');
      } else {
        const a = document.createElement('a'); a.href = url; a.download = name;
        document.body.appendChild(a); a.click(); a.remove();
      }
      setTimeout(() => URL.revokeObjectURL(url), 5000);
    }
  }
};
App.core.init();
</script>
</body>
</html>
