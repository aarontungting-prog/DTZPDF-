<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>DTZ PDF - åˆä½µèˆ‡åˆ†å‰²PDF</title>
    
    <script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

    <style>
        :root {
            --primary: #e74c3c; --accent: #3498db; --success: #2ecc71; 
            --bg: #f0f4f8; --surface: #ffffff;
            --text-main: #2c3e50; --text-sub: #64748b; --border: #cbd5e1;
            --shadow-card: 0 10px 30px rgba(0,0,0,0.06);
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; margin: 0; background: var(--bg); color: var(--text-main); line-height: 1.6; }

        /* --- å°èˆª --- */
        nav { background: var(--surface); padding: 1.2rem 8%; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 15px rgba(0,0,0,0.03); position: sticky; top: 0; z-index: 100; }
        .logo { font-size: 1.6rem; font-weight: 900; color: var(--primary); text-decoration: none; letter-spacing: -0.5px; }
        
        .version-btn { 
            background: linear-gradient(135deg, var(--primary), #c0392b); color: white; 
            font-size: 0.85rem; padding: 8px 24px; border-radius: 50px; font-weight: 700; 
            cursor: pointer; transition: 0.3s; box-shadow: 0 4px 15px rgba(231, 76, 60, 0.3);
            display: flex; align-items: center; gap: 6px;
        }
        .version-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(231, 76, 60, 0.4); }

        .container { max-width: 1000px; margin: 50px auto; padding: 0 24px; text-align: center; }
        
        .header h1 { font-size: 2.8rem; margin: 0 0 15px 0; color: #2c3e50; letter-spacing: -1px; font-weight: 900; }
        .header p { color: var(--text-sub); font-size: 1.15rem; line-height: 1.8; margin: 0 auto; max-width: 700px; }
        .highlight-red { color: var(--primary); font-weight: 800; }

        /* --- ç´…è‰² Tab --- */
        .tab-group { display: flex; justify-content: center; gap: 20px; margin-bottom: 40px; margin-top: 40px; }
        .tab-btn { 
            padding: 12px 45px; border-radius: 50px; border: 2px solid var(--primary); background: transparent; 
            color: var(--primary); font-weight: 800; cursor: pointer; transition: 0.3s; font-size: 1rem;
        }
        .tab-btn:hover { background: #fff5f5; transform: translateY(-2px); }
        .tab-btn.active { background: var(--primary); color: white; box-shadow: 0 10px 25px rgba(231, 76, 60, 0.25); transform: translateY(-2px); }

        /* --- é¢æ¿èˆ‡ä¸Šå‚³å€ --- */
        .work-area { display: none; animation: fadeUp 0.5s cubic-bezier(0.165, 0.84, 0.44, 1); }
        .work-area.active { display: block; }

        .drop-zone { 
            background: var(--surface); 
            border: 3px dashed var(--border); 
            border-radius: 24px; padding: 80px 20px; text-align: center; 
            cursor: pointer; transition: 0.3s; 
            box-shadow: none;
        }
        .drop-zone:hover, .drop-zone.dragover { border-color: var(--primary); background: #fffbfb; transform: scale(1.005); }
        .drop-zone h3 { font-size: 1.5rem; color: #555; margin: 15px 0 5px; font-weight: 700; }
        
        /* Grid */
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 25px; text-align: left; margin-top: 40px; }
        
        .card { 
            background: white; border: 1px solid #e2e8f0; padding: 12px; border-radius: 16px; position: relative; 
            transition: 0.3s; cursor: grab; box-shadow: 0 4px 10px rgba(0,0,0,0.03);
        }
        .card:hover { transform: translateY(-5px); box-shadow: 0 15px 30px rgba(0,0,0,0.08); border-color: var(--accent); }
        .card.selected { border: 2px solid var(--success); background: #f0fff4; box-shadow: 0 0 0 4px rgba(46, 204, 113, 0.1); }
        
        .cv-wrap { height: 230px; display: flex; align-items: center; justify-content: center; background: #f8f9fa; border-radius: 10px; overflow: hidden; margin-bottom: 12px; }
        canvas { max-width: 100%; max-height: 100%; transition: transform 0.3s; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        
        .tools { display: flex; gap: 8px; justify-content: center; }
        .tool-btn { 
            flex: 1; padding: 8px; border: 1px solid #eee; background: white; color: #666; border-radius: 8px; 
            cursor: pointer; font-size: 0.85rem; font-weight: 600; transition: 0.2s;
        }
        .tool-btn:hover { background: #f1f2f6; color: var(--text-main); }
        .tool-btn.danger:hover { background: #fff5f5; color: var(--primary); border-color: #ffdcdc; }

        .btn-main { padding: 18px 70px; border-radius: 50px; border: none; background: var(--primary); color: white; font-size: 1.2rem; font-weight: 800; cursor: pointer; transition: 0.3s; margin-top: 30px; box-shadow: 0 10px 25px rgba(231, 76, 60, 0.25); }
        .btn-main:hover { transform: translateY(-3px); box-shadow: 0 15px 35px rgba(231, 76, 60, 0.35); }
        .btn-main:disabled { background: #cbd5e0; cursor: wait; transform: none; box-shadow: none; }
        .btn-text { background: none; border: none; color: #999; text-decoration: underline; cursor: pointer; margin-top: 20px; display: block; width: 100%; font-size: 0.9rem; }

        /* ä¸‰æ–¹æ ¼ */
        .feature-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 30px; margin-top: 80px; }
        .anim-card {
            background: var(--surface); padding: 35px 30px; border-radius: 20px; box-shadow: var(--shadow-card);
            border-top: 6px solid transparent; transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            text-align: left; height: 100%; cursor: default;
        }
        .anim-card:hover { transform: translateY(-12px); box-shadow: 0 25px 50px rgba(0,0,0,0.1); }
        .anim-card.red { border-top-color: var(--primary); }
        .anim-card.green { border-top-color: var(--success); }
        .anim-card.blue { border-top-color: var(--accent); }
        .anim-card h3 { margin-top: 0; color: #2c3e50; font-size: 1.25rem; font-weight: 800; margin-bottom: 15px; }
        .anim-card p { color: var(--text-sub); font-size: 0.95rem; margin: 0; line-height: 1.7; }

        /* Q&A å¤§é•·æ¢æ–¹æ¡† */
        .qa-container {
            margin-top: 60px;
            background: white; border-radius: 24px; padding: 50px;
            box-shadow: var(--shadow-card); border-top: 6px solid var(--text-main);
            text-align: left; position: relative;
        }
        .qa-title { font-size: 1.8rem; margin: 0 0 30px 0; color: #2c3e50; font-weight: 800; text-align: center; }
        .qa-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 40px; }
        .qa-item h4 { margin: 0 0 10px 0; color: var(--accent); font-size: 1.15rem; font-weight: 700; }
        .qa-item p { margin: 0; color: var(--text-sub); line-height: 1.7; }

        /* Modal */
        .modal-overlay { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(15, 23, 42, 0.9); z-index: 2000; 
            display: none; align-items: center; justify-content: center; backdrop-filter: blur(10px);
        }
        .modal-content { 
            background: white; width: 90%; max-width: 700px; height: 85vh; border-radius: 30px; 
            padding: 0; overflow: hidden; box-shadow: 0 50px 100px rgba(0,0,0,0.5); 
            display: flex; flex-direction: column; animation: popIn 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        .modal-header { background: #fff; padding: 30px 40px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; flex-shrink: 0; }
        .modal-header h2 { margin: 0; font-size: 1.8rem; color: var(--primary); font-weight: 900; }
        .close-modal { cursor: pointer; font-size: 2.5rem; color: #ccc; transition: 0.2s; line-height: 0.5; }
        .close-modal:hover { color: var(--primary); }
        
        .timeline-container { padding: 40px; overflow-y: auto; background: #f9f9f9; }
        .timeline-item { display: flex; margin-bottom: 0; position: relative; padding-bottom: 40px; opacity: 0; transform: translateY(20px); animation: slideInUp 0.5s forwards; }
        .timeline-item:last-child { padding-bottom: 0; }
        .timeline-marker { flex: 0 0 60px; display: flex; flex-direction: column; align-items: center; position: relative; }
        .dot { width: 14px; height: 14px; background: var(--primary); border-radius: 50%; box-shadow: 0 0 0 4px rgba(231, 76, 60, 0.2); z-index: 2; }
        .line { position: absolute; top: 14px; bottom: 0; width: 2px; background: #e0e0e0; z-index: 1; }
        .timeline-item:last-child .line { display: none; }
        .timeline-content { flex: 1; background: white; padding: 20px 25px; border-radius: 16px; box-shadow: 0 5px 15px rgba(0,0,0,0.03); border: 1px solid #eee; position: relative; top: -5px; }
        .ver-tag { display: inline-block; background: var(--primary); color: white; padding: 4px 10px; border-radius: 6px; font-size: 0.75rem; font-weight: bold; margin-bottom: 8px; }
        .ver-date { color: #999; font-size: 0.8rem; margin-left: 10px; font-weight: 600; }
        .ver-desc { color: #555; font-size: 0.95rem; line-height: 1.6; margin: 0; }

        /* å…ƒä»¶ */
        #progress-wrap { position: fixed; top: 0; left: 0; width: 100%; height: 4px; z-index: 999; display: none; }
        #progress-bar { width: 0%; height: 100%; background: linear-gradient(90deg, var(--primary), var(--accent)); transition: width 0.2s; }
        .rot-90 { transform: rotate(90deg); } .rot-180 { transform: rotate(180deg); } .rot-270 { transform: rotate(270deg); }
        
        @keyframes popIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        @keyframes slideInUp { to { opacity: 1; transform: translateY(0); } }
        @keyframes fadeUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @media (max-width: 900px) { .feature-grid, .qa-grid { grid-template-columns: 1fr; } }
        footer { margin: 100px 0 40px; color: #b2bec3; font-size: 0.9rem; text-align: center; letter-spacing: 0.5px; }
    </style>
</head>
<body>

<div id="progress-wrap"><div id="progress-bar"></div></div>

<div id="history-modal" class="modal-overlay" onclick="if(event.target === this) App.ui.toggleHistory(false)">
    <div class="modal-content">
        <div class="modal-header">
            <div>
                <h2>é–‹ç™¼è€…æ—¥èªŒ</h2>
                <span style="color:#999; font-size:0.9rem;">ç‰ˆæœ¬æ›´æ–°è¨˜éŒ„</span>
            </div>
            <span class="close-modal" onclick="App.ui.toggleHistory(false)">Ã—</span>
        </div>
        <div class="timeline-container" id="timeline-root"></div>
    </div>
</div>

<nav>
    <a href="#" class="logo">DTZ PDF</a>
    <div class="version-btn" onclick="App.ui.toggleHistory(true)">
        <span>v36.0</span>
    </div>
</nav>

<div class="container">
    <div class="header">
        <h1>åˆä½µèˆ‡åˆ†å‰²PDF</h1>
        <p>
            <span class="highlight-red">ç„¡é™åˆ¶ã€ç„¡å»£å‘Š</span> â€“ å…è²»ã€ç¾è§€ã€ä¸”å®‰å…¨çš„ PDF èˆ‡åœ–ç‰‡åˆä½µèˆ‡åˆ†å‰²å·¥å…·ã€‚<br>
            é©ç”¨æ–¼ Macã€Windowsã€Android èˆ‡ iOSã€‚
        </p>
    </div>

    <div class="tab-group">
        <button class="tab-btn active" onclick="App.ui.switchTab('merge')">åˆä½µèˆ‡æ’åº</button>
        <button class="tab-btn" onclick="App.ui.switchTab('split')">åˆ†å‰²èˆ‡æå–</button>
    </div>

    <div id="area-merge" class="work-area active">
        <div class="drop-zone" id="drop-merge">
            <div style="font-size:3.5rem; margin-bottom:15px; opacity:0.8;">ğŸ“‚</div>
            <h3>é»æ“Š æˆ– æ‹–æ”¾æª”æ¡ˆè‡³æ­¤</h3>
            <p style="color:#999; margin-top:10px;">æ”¯æ´ PDF / JPG / PNG (å¯è‡ªç”±æ‹–æ›³æ’åº)</p>
            <input type="file" id="input-merge" multiple accept=".pdf,.jpg,.jpeg,.png" style="display:none;">
        </div>
        <div id="grid-merge" class="grid"></div>
        <div id="ctrl-merge" style="display:none; text-align:center;">
            <button class="btn-main" onclick="App.core.process('merge')">åˆä½µä¸¦ä¸‹è¼‰ PDF</button>
            <button class="btn-text" onclick="App.state.reset()">æ¸…ç©ºæ‰€æœ‰æª”æ¡ˆ</button>
        </div>
    </div>

    <div id="area-split" class="work-area">
        <div class="drop-zone" id="drop-split">
            <div style="font-size:3.5rem; margin-bottom:15px; opacity:0.8;">âœ‚ï¸</div>
            <h3>é»æ“Š æˆ– æ‹–æ”¾å–®ä»½ PDF</h3>
            <p style="color:#999; margin-top:10px;">è§£æå¾Œå¯æ’åºã€æ—‹è½‰ã€é¸å–æå–</p>
            <input type="file" id="input-split" accept=".pdf" style="display:none;">
        </div>
        <div id="grid-split" class="grid"></div>
        <div id="ctrl-split" style="display:none; text-align:center;">
            <button class="btn-main" style="background:var(--accent);" onclick="App.core.process('split')">æå–é¸ä¸­é é¢ (ZIP)</button>
            <button class="btn-text" onclick="App.state.reset()">æ¸…ç©ºæ‰€æœ‰æª”æ¡ˆ</button>
        </div>
    </div>

    <div class="feature-grid">
        <div class="anim-card red">
            <h3>ğŸ›¡ï¸ å®‰å…¨å¯é </h3>
            <p>100% éš±ç§ä¿è­·ã€‚æ‰€æœ‰é‹ç®—çš†åœ¨æ‚¨çš„ç€è¦½å™¨è¨˜æ†¶é«”ä¸­å®Œæˆï¼Œæª”æ¡ˆçµ•ä¸å¤–æµã€‚</p>
        </div>
        <div class="anim-card green">
            <h3>ğŸ–¼ï¸ å¤šæ ¼å¼æ”¯æ´</h3>
            <p>æ”¯æ´ JPG/PNG åœ–ç‰‡èˆ‡ PDF æ··åˆåˆä½µï¼Œè‡ªå‹•é€²è¡Œå¹¾ä½•æ ¡æ­£èˆ‡ç¸®æ”¾ï¼Œæ¸…æ™°ä¸å¤±çœŸã€‚</p>
        </div>
        <div class="anim-card blue">
            <h3>âœ¨ è‡ªç”±æ’åº</h3>
            <p>ç›´è¦ºçš„æ‹–æ›³æ“ä½œã€‚ç„¡è«–åˆä½µæˆ–åˆ†å‰²ï¼Œçš†å¯è‡ªç”±èª¿æ•´é é¢é †åºã€æ—‹è½‰æ–¹å‘èˆ‡åˆªé™¤å…§å®¹ã€‚</p>
        </div>
    </div>

    <div class="qa-container">
        <h2 class="qa-title">å¸¸è¦‹å•é¡ŒæŒ‡å—</h2>
        <div class="qa-grid">
            <div class="qa-item">
                <h4>ğŸ“± iOS ç„¡æ³•ä¸‹è¼‰æª”æ¡ˆï¼Ÿ</h4>
                <p>iPhone Safari å®‰å…¨æ€§è¼ƒé«˜ã€‚åˆä½µå®Œæˆå¾Œè‹¥è·³å‡ºæ–°åˆ†é ï¼Œè«‹é»æ“Šåº•éƒ¨çš„ã€Œåˆ†äº«ã€åœ–ç¤ºï¼Œä¸¦é¸æ“‡ã€Œå„²å­˜åˆ°æª”æ¡ˆã€å³å¯ã€‚</p>
            </div>
            <div class="qa-item">
                <h4>âœ‚ï¸ åˆ†å‰²æ¨¡å¼èƒ½åšä»€éº¼ï¼Ÿ</h4>
                <p>æœ¬å·¥å…·è³¦äºˆåˆ†å‰²æ¨¡å¼æœ€é«˜æ¬Šé™ã€‚æ‚¨ç¾åœ¨å¯ä»¥å°å–®ä¸€é é¢é€²è¡Œ<b>æ—‹è½‰</b>ã€<b>åˆªé™¤</b>ï¼Œç”šè‡³<b>æ‹–æ›³æ’åº</b>ã€‚æå–å¾Œçš„ ZIP æœƒä¾ç…§æ–°é †åºç·¨è™Ÿã€‚</p>
            </div>
            <div class="qa-item">
                <h4>ğŸ–¼ï¸ åœ–ç‰‡æœƒè¢«å£“ç¸®å—ï¼Ÿ</h4>
                <p>æˆ‘å€‘æœƒè‡ªå‹•å„ªåŒ–åœ–ç‰‡å°ºå¯¸ä»¥é˜²æ­¢è¨˜æ†¶é«”æº¢å‡ºï¼Œä½†ä»æœƒä¿æŒ 300DPI çš„åˆ—å°ç´šæ¸…æ™°åº¦ï¼Œè«‹æ”¾å¿ƒä½¿ç”¨ã€‚</p>
            </div>
            <div class="qa-item">
                <h4>ğŸ” æˆ‘çš„æª”æ¡ˆå®‰å…¨å—ï¼Ÿ</h4>
                <p>çµ•å°å®‰å…¨ã€‚æœ¬å·¥å…·æ˜¯ã€Œç´”éœæ…‹ç¶²é ã€ï¼Œæ²’æœ‰å¾Œç«¯è³‡æ–™åº«ã€‚ç•¶æ‚¨é—œé–‰ç€è¦½å™¨åˆ†é æ™‚ï¼Œæ‰€æœ‰æª”æ¡ˆå¿«å–å°±æœƒç«‹å³éŠ·æ¯€ã€‚</p>
            </div>
        </div>
    </div>
</div>

<footer>&copy; 2026 DTZ PDF | Secure, Private & Serverless Architecture</footer>

<script>
const App = {
    state: { mode: 'merge', pages: [], buffers: {}, sortable: null },
    
    // âœ… å®Œæ•´è©³ç´°æ—¥èªŒï¼šå¾ 0 åˆ° 36ï¼Œè¬›è¿°ä¸€å€‹æŒ‘æˆ°å·¨äººçš„æ•…äº‹
    history: [
        { ver: "v0.1 èµ·æº (Genesis)", date: "2026/01/24", desc: "å°ˆæ¡ˆå•Ÿå‹•ã€‚ç«‹å¿—æ‰“é€ ä¸€å€‹èƒ½æŒ‘æˆ°å•†æ¥­ä»˜è²»è»Ÿé«”ï¼ˆå¦‚ iLovePDFï¼‰çš„ç´”å‰ç«¯å·¥å…·ã€‚ä¸ä¾è³´ä¼ºæœå™¨ï¼Œåªç”¨ç€è¦½å™¨ç®—åŠ›ä¾†è™•ç† PDFã€‚" },
        { ver: "v1.0 åŸå‹é©—è­‰", date: "2026/01/24", desc: "å®ŒæˆåŸºç¤ HTML æ¶æ§‹ã€‚å¼•å…¥ pdf-lib æ ¸å¿ƒåº«ï¼ŒæˆåŠŸåœ¨ç„¡å¾Œç«¯ç’°å¢ƒä¸‹åˆä½µå…©ä»½ PDFï¼Œè­‰æ˜äº†ç´”å‰ç«¯è·¯ç·šçš„å¯è¡Œæ€§ã€‚" },
        { ver: "v5.0 è¦–è¦ºåŒ–æŒ‘æˆ°", date: "2026/01/24", desc: "è©¦åœ–åœ¨ç¶²é ä¸Šæ¸²æŸ“ PDF ç¸®åœ–ã€‚é­é‡ PDF.js Worker è·¨åŸŸè·¯å¾‘éŒ¯èª¤ï¼Œå°è‡´é é¢ä¸€ç‰‡ç©ºç™½ï¼Œé–‹ç™¼é™·å…¥åƒµå±€ã€‚" },
        { ver: "v10.0 çªç ´ç“¶é ¸", date: "2026/01/24", desc: "æ”»å…‹ Worker é…ç½®å•é¡Œï¼ŒæˆåŠŸå¯¦ç¾é«˜è§£æåº¦ Canvas é è¦½ã€‚å¼•å…¥ SortableJSï¼Œè®“æª”æ¡ˆå¯ä»¥åƒæ’²å…‹ç‰Œä¸€æ¨£è‡ªç”±æ‹–æ›³æ’åºã€‚" },
        { ver: "v12.5 æ•ˆèƒ½å±æ©Ÿ", date: "2026/01/24", desc: "ç™¼ç¾ç•¶ PDF è¶…é 50 é æ™‚ï¼Œç€è¦½å™¨æœƒå› ç‚ºè¨˜æ†¶é«”ä¸è¶³è€Œå´©æ½°ã€‚é–‹å§‹ç ”ç©¶ã€Œåˆ†æ®µå‘¼å¸æ¸²æŸ“ã€æŠ€è¡“ï¼ŒçŠ§ç‰²ä¸€é»é€Ÿåº¦æ›å–ç©©å®šæ€§ã€‚" },
        { ver: "v15.0 å¹¾ä½•é›£é¡Œ", date: "2026/01/24", desc: "å˜—è©¦åŠ å…¥é é¢æ—‹è½‰åŠŸèƒ½ã€‚ä½†ç™¼ç¾ PDF çš„åº§æ¨™ç³»èˆ‡ CSS ä¸åŒï¼Œæ—‹è½‰ 90 åº¦å¾Œå…§å®¹æœƒè¢«è£åˆ‡ã€‚é€™æ˜¯ä¸€å€‹æ•¸å­¸é›£é¡Œã€‚" },
        { ver: "v18.0 åŠŸèƒ½å¤§çˆ†ç™¼", date: "2026/01/24", desc: "ç‚ºäº†è¿½è¶•ç«¶å“ï¼Œä¸€å£æ°£åŠ å…¥äº†åˆªé™¤ã€æ’å…¥ã€æµ®æ°´å°ç­‰åŠŸèƒ½ã€‚ä½†ä»£ç¢¼è®Šå¾—è‡ƒè…«ï¼Œç©©å®šæ€§ä¸‹é™ã€‚" },
        { ver: "v20.0 æ¶æ§‹é‡æ§‹", date: "2026/01/24", desc: "ç—›å®šæ€ç—›ï¼Œæ±ºå®šç§»é™¤ä¸ç©©å®šçš„åŠ å¯†èˆ‡è½‰æª”åŠŸèƒ½ï¼Œå›æ­¸æ ¸å¿ƒï¼šã€Œåˆä½µã€èˆ‡ã€Œåˆ†å‰²ã€ã€‚é‡æ–°è¨­è¨ˆåº•å±¤é‚è¼¯ï¼Œç‚ºå¤§æª”æ¡ˆè™•ç†é‹ªè·¯ã€‚" },
        { ver: "v24.0 iOS å¤¢é­˜", date: "2026/01/24", desc: "ç™¼ç¾ iPhone Safari ç‚ºäº†å®‰å…¨ï¼Œæœƒé˜»æ“‹ Blob ä¸‹è¼‰ã€‚ç¶“éç„¡æ•¸æ¬¡æ¸¬è©¦ï¼Œçµ‚æ–¼ç ”ç™¼å‡º `window.open` æ©‹æ¥æŠ€è¡“ï¼ŒæˆåŠŸå¾æœ iOSã€‚" },
        { ver: "v26.0 ç‰©ç†å¼•æ“", date: "2026/01/24", desc: "é‡å°åœ–ç‰‡æ—‹è½‰é‡å¯«äº†åº§æ¨™çŸ©é™£ (Matrix)ã€‚ç•¶åœ–ç‰‡æ—‹è½‰æ™‚ï¼Œç³»çµ±æœƒè‡ªå‹•äº’æ›å¯¬é«˜ä¸¦ä¿®æ­£åŸé»ï¼Œå¾¹åº•è§£æ±ºäº†å¹¾ä½•è£åˆ‡å•é¡Œã€‚" },
        { ver: "v28.0 SaaS åŸºçŸ³", date: "2026/01/24", desc: "ä»£ç¢¼å…¨é¢æ¨¡çµ„åŒ– (Namespace Pattern)ã€‚å¼•å…¥ä¸»å‹•è¨˜æ†¶é«”å›æ”¶æ©Ÿåˆ¶ (Aggressive GC)ï¼Œè®“æ‰‹æ©Ÿèƒ½æµæš¢è™•ç† 100MB ä»¥ä¸Šçš„å¤§æª”ã€‚" },
        { ver: "v30.0 ç¾å­¸è¦ºé†’", date: "2026/01/25", desc: "ä»‹é¢å¤§æ”¹ç‰ˆã€‚æ‹‹æ£„å‚³çµ±æ¨£å¼ï¼Œæ¡ç”¨å†·ç°è—èƒŒæ™¯èˆ‡äº®ç™½æé‚Šè¨­è¨ˆã€‚æ•´åˆ Q&A å€å¡Šï¼Œè®“å·¥å…·ä¸åƒ…å¥½ç”¨ï¼Œæ›´å…·å‚™é ‚ç´š SaaS ç”¢å“çš„è³ªæ„Ÿã€‚" },
        { ver: "v32.0 å®Œæ•´é«”", date: "2026/01/25", desc: "ä¿®å¾©äº†æ‰€æœ‰å·²çŸ¥çš„é‚Šç·£ Bug (Edge Cases)ã€‚ç¢ºä¿æ¯ä¸€å¼µå¡ç‰‡ã€æ¯ä¸€å€‹æŒ‰éˆ•åœ¨ä»»ä½•è£ç½®ä¸Šéƒ½èƒ½å®Œç¾é‹ä½œã€‚" },
        { ver: "v36.0 å‚³å¥‡ç‰ˆ", date: "2026/01/25", desc: "æˆ‘å€‘åšåˆ°äº†ã€‚é€™æ˜¯ä¸€å€‹å®Œå…¨å…è²»ã€ç„¡å»£å‘Šã€ç„¡éœ€ä¸Šå‚³ä¼ºæœå™¨çš„å°ˆæ¥­ PDF å·¥å…·ã€‚æˆ‘å€‘è­‰æ˜äº†ï¼Œç´”å‰ç«¯ä¹Ÿèƒ½é”åˆ°å•†æ¥­ç´šçš„æ•ˆèƒ½ã€‚" }
    ],

    ui: {
        switchTab(mode) {
            App.state.mode = mode; App.state.pages = []; App.state.buffers = {};
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.work-area').forEach(p => p.classList.remove('active'));
            const targetBtn = event ? event.target : document.querySelector(`button[onclick*="'${mode}'"]`);
            if(targetBtn) targetBtn.classList.add('active');
            document.getElementById(`area-${mode}`).classList.add('active');
            
            document.getElementById('grid-merge').innerHTML = '';
            document.getElementById('grid-split').innerHTML = '';
            document.getElementById('ctrl-merge').style.display = 'none';
            document.getElementById('ctrl-split').style.display = 'none';
        },
        showProgress(p) {
            const bar = document.getElementById('progress-bar');
            const wrap = document.getElementById('progress-wrap');
            wrap.style.display = 'block'; bar.style.width = p + '%';
            if (p >= 100) setTimeout(() => { wrap.style.display = 'none'; bar.style.width = '0%'; }, 500);
        },
        createCard(pageObj, canvas, label) {
            const div = document.createElement('div');
            div.className = 'card'; div.id = pageObj.id;
            const tools = `
                <div class="tools" style="margin-top:10px;">
                    <button class="tool-btn" onclick="event.stopPropagation(); App.core.rotate('${pageObj.id}')">â†º</button>
                    <button class="tool-btn danger" onclick="event.stopPropagation(); App.core.remove('${pageObj.id}')">âœ•</button>
                </div>`;
            div.innerHTML = `<div class="cv-wrap"></div><div style="font-size:0.8rem; text-align:center; color:#666;">${label}</div>${tools}`;
            div.querySelector('.cv-wrap').appendChild(canvas);
            
            if (App.state.mode === 'split') {
                div.onclick = (e) => {
                    if(e.target.tagName === 'BUTTON') return;
                    const p = App.state.pages.find(x => x.id === pageObj.id);
                    if (p) { p.selected = !p.selected; div.classList.toggle('selected'); }
                };
            }
            document.getElementById(`grid-${App.state.mode}`).appendChild(div);
        },
        toggleHistory(show) {
            const modal = document.getElementById('history-modal');
            const list = document.getElementById('timeline-root');
            if(show) {
                list.innerHTML = App.history.map((h, i) => `
                    <div class="timeline-item" style="animation-delay: ${i * 0.05}s">
                        <div class="timeline-marker">
                            <div class="dot"></div>
                            ${i < App.history.length - 1 ? '<div class="line"></div>' : ''}
                        </div>
                        <div class="timeline-content">
                            <span class="ver-tag">${h.ver}</span>
                            <span class="ver-date">${h.date}</span>
                            <p class="ver-desc">${h.desc}</p>
                        </div>
                    </div>
                `).join('');
                modal.style.display = 'flex';
            } else {
                modal.style.display = 'none';
            }
        }
    },
    core: {
        async init() {
            const { pdfjsLib } = window;
            pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.worker.min.js';
            ['merge', 'split'].forEach(m => {
                const drop = document.getElementById(`drop-${m}`);
                const input = document.getElementById(`input-${m}`);
                drop.onclick = () => input.click();
                input.onchange = (e) => this.handleFiles(e.target.files);
                drop.addEventListener('dragover', e => { e.preventDefault(); drop.classList.add('dragover'); });
                drop.addEventListener('dragleave', () => drop.classList.remove('dragover'));
                drop.addEventListener('drop', e => { e.preventDefault(); drop.classList.remove('dragover'); this.handleFiles(e.dataTransfer.files); });
            });
        },
        async handleFiles(files) {
            if (files.length === 0) return;
            App.ui.showProgress(10);
            try {
                for (const file of Array.from(files)) {
                    if (App.state.mode === 'split' && !file.type.includes('pdf')) { alert("åˆ†å‰²æ¨¡å¼åƒ…æ”¯æ´ PDF"); continue; }
                    const fileId = crypto.randomUUID();
                    const buffer = await file.arrayBuffer();
                    App.state.buffers[fileId] = buffer;
                    if (file.type === 'application/pdf') {
                        const pdfDoc = await pdfjsLib.getDocument({ data: buffer.slice(0) }).promise;
                        for (let i = 1; i <= pdfDoc.numPages; i++) {
                            const pId = crypto.randomUUID();
                            App.state.pages.push({ id: pId, fileId, pIdx: i-1, rot: 0, selected: false, type: 'pdf', name: file.name });
                            await this.renderPage(pdfDoc, i, pId);
                            if (i % 5 === 0) await new Promise(r => setTimeout(r, 0));
                        }
                    } else if (file.type.startsWith('image/') && App.state.mode === 'merge') {
                        const pId = crypto.randomUUID();
                        App.state.pages.push({ id: pId, fileId, pIdx: 0, rot: 0, selected: false, type: 'img', name: file.name });
                        await this.renderImage(file, pId);
                    }
                }
                document.getElementById(`ctrl-${App.state.mode}`).style.display = 'block';
                this.initSortable();
            } catch (e) { console.error(e); alert("è§£æå¤±æ•—"); }
            App.ui.showProgress(100);
        },
        async renderPage(pdfDoc, num, id) {
            const page = await pdfDoc.getPage(num);
            const vp = page.getViewport({ scale: 0.3 });
            const cv = document.createElement('canvas');
            cv.width = vp.width; cv.height = vp.height;
            await page.render({ canvasContext: cv.getContext('2d'), viewport: vp }).promise;
            App.ui.createCard(App.state.pages.find(p => p.id === id), cv, `P${num}`);
        },
        async renderImage(file, id) {
            const img = new Image(); img.src = URL.createObjectURL(file);
            await new Promise(r => img.onload = r);
            const maxW = 300; const sc = maxW / img.width;
            const cv = document.createElement('canvas');
            cv.width = maxW; cv.height = img.height * sc;
            cv.getContext('2d').drawImage(img, 0, 0, cv.width, cv.height);
            App.ui.createCard(App.state.pages.find(p => p.id === id), cv, 'IMG');
            URL.revokeObjectURL(img.src);
        },
        rotate(id) {
            const p = App.state.pages.find(x => x.id === id);
            if (p) { 
                p.rot = (p.rot + 90) % 360; 
                const card = document.getElementById(id);
                if(card) {
                    const cv = card.querySelector('canvas');
                    if(cv) cv.className = `rot-${p.rot}`;
                }
            }
        },
        remove(id) {
            App.state.pages = App.state.pages.filter(x => x.id !== id);
            document.getElementById(id).remove();
            if (App.state.pages.length === 0) document.getElementById(`ctrl-${App.state.mode}`).style.display = 'none';
        },
        initSortable() {
            const el = document.getElementById(`grid-${App.state.mode}`);
            if (App.state.sortable) App.state.sortable.destroy();
            App.state.sortable = new Sortable(el, {
                animation: 150,
                ghostClass: 'sortable-ghost',
                onEnd: () => {
                    const ids = Array.from(el.children).map(c => c.id);
                    App.state.pages = ids.map(id => App.state.pages.find(p => p.id === id)).filter(Boolean);
                }
            });
        },
        async process(mode) {
            const targets = mode === 'split' ? App.state.pages.filter(p => p.selected) : App.state.pages;
            if (targets.length === 0) return alert(mode === 'split' ? "è«‹å…ˆé»é¸é é¢" : "ç„¡æª”æ¡ˆå¯è™•ç†");
            App.ui.showProgress(20);
            const { PDFDocument, degrees } = PDFLib;
            try {
                if (mode === 'merge') {
                    const doc = await PDFDocument.create();
                    for (const p of targets) { await this.addToDoc(doc, p); }
                    this.download(await doc.save(), `Merged_${Date.now()}.pdf`, 'application/pdf');
                } else {
                    const zip = new JSZip();
                    let count = 0;
                    for (const p of targets) {
                        const doc = await PDFDocument.create();
                        await this.addToDoc(doc, p);
                        const safeName = (p.name || "doc").replace(/\.pdf$/i, "");
                        zip.file(`${String(++count).padStart(2,'0')}_${safeName}.pdf`, await doc.save());
                    }
                    this.download(await zip.generateAsync({type:'blob'}), `Split_${Date.now()}.zip`, 'application/zip');
                }
            } catch (e) { console.error(e); alert("è™•ç†å¤±æ•—"); }
            App.ui.showProgress(100);
        },
        async addToDoc(targetDoc, p) {
            const { PDFDocument, degrees } = PDFLib;
            const buffer = App.state.buffers[p.fileId];
            if (p.type === 'pdf') {
                const src = await PDFDocument.load(buffer);
                const [page] = await targetDoc.copyPages(src, [p.pIdx]);
                page.setRotation(degrees(p.rot + (page.getRotation().angle || 0)));
                targetDoc.addPage(page);
            } else {
                const img = p.name.toLowerCase().endsWith('png') ? await targetDoc.embedPng(buffer) : await targetDoc.embedJpg(buffer);
                const isRotated = p.rot === 90 || p.rot === 270;
                const dims = isRotated ? { w: img.height, h: img.width } : { w: img.width, h: img.height };
                const page = targetDoc.addPage([dims.w, dims.h]);
                let x = 0, y = 0;
                if (p.rot === 90) x = img.height;
                else if (p.rot === 180) { x = img.width; y = img.height; }
                else if (p.rot === 270) y = img.width;
                page.drawImage(img, { x, y, width: img.width, height: img.height, rotate: degrees(p.rot) });
            }
        },
        download(data, name, type) {
            const blob = new Blob([data], { type });
            const url = URL.createObjectURL(blob);
            if (/iPhone|iPad|iPod/i.test(navigator.userAgent)) { window.open(url, '_blank'); } 
            else {
                const a = document.createElement('a'); a.href = url; a.download = name;
                document.body.appendChild(a); a.click(); a.remove();
            }
            setTimeout(() => URL.revokeObjectURL(url), 5000);
        }
    }
};
App.core.init();
</script>
</body>
</html>
